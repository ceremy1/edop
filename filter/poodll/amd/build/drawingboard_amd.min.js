define(["jquery","core/log","filter_poodll/utils_amd","filter_poodll/uploader","filter_poodll/drawingboard"],function(a,b,c,d,e){"use strict";return b.debug("Filter PoodLL: drawingboard.js initialising"),{whiteboard:null,loaddrawingboard:function(b){var c="#amdopts_"+b.recorderid,f=a(c).get(0);if(f){if(b=JSON.parse(f.value),b.bgimage)var g="transparent";else{var g="background";b.bgimage="#FFF"}this.config=b,a(c).remove()}var h="#"+b.recorderid+"drawing-board-id",i=new e.Board(b.recorderid+"_drawing-board-id",{recorderid:b.recorderid,size:3,background:b.bgimage,controls:["Color",{Size:{type:"auto"}},{DrawingMode:{filler:!1,eraser:!0,pencil:!0}},"Navigation"],droppable:!0,webStorage:!1,enlargeYourContainer:!0,eraserColor:g});this.whiteboard=i,d.init(h,b);var j=b.vectordata;j&&0!=j.indexOf('{"shapes"')&&0!=j.indexOf('{"colors"')&&(i.history=Y.JSON.parse(j),i.setImg(i.history.values[i.history.position-1])),this.registerEvents()},registerEvents:function(){var b=this.config.recorderid,e=this,f=this.config;this.config.autosave?(this.whiteboard.ev.bind("board:startDrawing",function(){var a=document.getElementById(b+"_messages");if(a){a.innerHTML="File has not been saved.";var d=document.getElementById(b+"_btn_upload_whiteboard");d.disabled=!1;var g=c.timeouthandles[b];g&&clearTimeout(g),c.timeouthandles[b]=setTimeout(function(){c.WhiteboardUploadHandler(b,e.whiteboard,f)},f.autosave)}}),this.whiteboard.ev.bind("board:stopDrawing",function(){var a=document.getElementById(b+"_messages");if(a){var d=c.timeouthandles[b];d&&clearTimeout(d),c.timeouthandles[b]=setTimeout(function(){c.WhiteboardUploadHandler(b,e.whiteboard,f)},f.autosave)}})):this.whiteboard.ev.bind("board:stopDrawing",function(){var a=document.getElementById(b+"_messages");a&&(a.innerHTML="File has not been saved.")});var g="#"+f.recorderid+"_btn_upload_whiteboard",h=a(g);if(h)if(f.autosave)h.click(function(){c.WhiteboardUploadHandler(b,e.whiteboard,f)});else{var i=c.getCvs(f.recorderid,e.whiteboard,f);h.click(function(){c.pokeVectorData(f.recorderid,e.whiteboard,f),d.uploadFile(i.toDataURL(),"image")},!1)}}}});